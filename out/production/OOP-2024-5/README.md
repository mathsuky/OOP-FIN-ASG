# 2024年度オブジェクト指向プログラミング 最終課題

以下のおにごっこのシミュレーションを行うプログラムを作成せよ。
そのプログラムに対して実装した範囲、および要求された仕様以外の拡張（戦略やゲーム盤面のパターンなど）を行った箇所について、説明を`Report.txt`に記せ。特に拡張を行った場合、必ず入力方法を記述せよ。要求を過不足なく実装した場合はそのように記述すること。

なお、「過不足ない」とは「指定されたものは全てある」かつ「指定されたもの以外にはない」の意味であることに注意せよ。<!-- ときどき、「過不足無く実装した。拡張は...」のようなレポートを見かけて脱力するので。 -->

最終課題には課題としての制約があり（本ファイルの最後）、違反すると本課題の採点結果が0点になる。
かなり形式的なものなので気をつけてもらいたい。

入力は条件を満たす場合に動作すれば十分だが、正しくない入力（パラメータや番号が範囲外、初期状態が条件を無視している、など）に対して、プログラムを停止させるか、解釈を決めて続行するか、エラーメッセージを出力するかなどについては自由に決めてよい。



## 締め切り
2/12(水) 23:59（日本時間/T2SCHOLA時間）


## 課題の概要

格子状に並ぶ領域とそれらを結ぶ通路で鬼（捕まえる側）と子（逃げる側）でおにごっこを行う。
規定時間以内に全員を捕まえれば鬼の勝ち、その間誰か一人でも逃げ切れば子の勝ちである。
なお、通常のおにごっこにおいて鬼は一人であることが多いが、本課題においては複数人のことがある。


## シミュレーションに関する説明

### 矩形領域について

- 鬼や子がいられる領域は格子状に並んでおり矩形をなす。便宜上、直交する方向を東西と南北と呼び分けることにする。
- 領域は東西に`R+1`個、南北に`T+1`個あり、西から東へ向けて`x`番目（0-origin）、南から北へ向けて`y`番目の領域を`(x, y)`という自然数の組で表現する。（`0 <= x <= R`、`0 <= y <= T`）
- (つまり，数学の第一象限+減点である)
- 通路は領域間にのみ存在し、東西と南北の4方向に加え、斜め（北東、北西、南東、南西）につながっている。つまり内側の領域は8方向につながっている。（端から外に出ることはできない）
- 異なる領域をつなぐ通路は互いに交差しない。例えば`(2,3)`と`(3,4)`間の通路と`(3,3)`と`(2,4)`間の通路は互いに行き来できない。
<!-- 設定が苦しいが、斜め同士が交差しないのは高さ方向でずれているのだと考えてほしい。 -->


### プレイヤー

- プレイヤーは鬼か子のどちらかである。
- 全てのプレイヤーは他のプレイヤーが鬼か子かを知っている。（個性までは知らない）
- プレイヤーは初期どこかの領域にいる。鬼と子が初期に同じ位置にいることはない。（鬼同士、子同士が同じ位置にいることはある）
- ゲーム中、プレイヤーは互いにどのプレイヤーがどの領域にいるのかがわかる。


### ゲームルール

- 規定の時間`N`が決まっており、子の誰か一人でも`N`時間まで捕まらなければ子の勝ちである。
- `N`時間までに子を全て捕まえればその時点でゲームが終了し、鬼の勝ちである。（ちょうど`N`時間に全員捕まえた場合は鬼の勝ち）
- 単位時間ごとに、全てのプレイヤーは同時に高々1つだけ通路を通り抜ける。（通路に入らずに領域に留まることも可能である）途中で移動をやめる、などはできない。
- 鬼は、子が同じ領域にいる場合または同じ通路を通った場合（すれ違った場合）その子を捕まえる。
- 子は捕まったらゲームから除外される。




### パラメータ制限

- 東西の幅`R`：`1 <= R <= 100`
- 南北の幅`T`：`1 <= T <= 100`
- 時間制限`N`：`0 <= N <= 1000`
- 鬼の数`O`：`0 <= O <= 100`
- 子の数`C`：`0 <= C <= 100`


## プログラムの仕様

### 入力フォーマット

以下のようになっている。
```
R T N O C
(O行の鬼の設定)
(C行の子の設定)
```
1行目に東西の幅`R`、南北の幅`T`、時間制限`N`、鬼の数`O`、子の数`C`が単一の空白を開けて与えられる。
2行目から`O+1`行目には鬼の設定が与えられる。（注：`O`が0のときには次の設定へ行く）
また、`O+2行目`から`C+O+1`行目には子の設定が与えられる。（注：`C`が0のときにはここで入力終了である）

鬼と子の設定の書式は以下の通りである。
```
x y p
```
`x`と`y`は初期に`(x, y)`の領域にいることを表し、`p`はその鬼（または子）の行動パターンを表す数字である。
以下、数字と鬼の行動パターン、数字と子の行動パターンを表す。

- 鬼の場合
  - 0 : 動かない
  - 1 : 初期は北（`y`を大きくする方向）に向かい、`y`が`T`になったら時計回り（東、南、西、北の順）で端を動く。はじめから`y`が`T`の場合は最初から時計回りで端を動く。
  - 2 : 初期は南（`y`を小さくする方向）に向かい、`y`が0になったら反時計回り（東、北、西、南の順）で端を動く。はじめから`y`が0の場合は最初から反時計回りで端を動く。
  - 3 : 最も近い子の方へ動く。「最も近い」とは「斜めを含めて時間数が最小で到達できる」ことを指す。また、近づき方は`x`と`y`の両方に差がある場合は斜めに（どちらも差を縮めるように）、一方だけ差がある場合はその方向に動く。なお、「最も近い」子が複数いる場合は入力で先に記述された子を優先するものとする。

- 子の場合
  - 0 : 動かない
  - 1 : 初期は東（`x`を大きくする方向）に向かい、`x`が`R`になったら時計回り（南、西、北、東の順）で端を動く。はじめから`x`が`R`の場合は最初から時計回りで端を動く。
  - 2 : 初期は西（`x`を小さくする方向）に向かい、`x`が0になったら反時計回り（南、東、北、西の順）で端を動く。はじめから`x`が0の場合は最初から反時計回りで端を動く。
  - 3 : 最も近い鬼から離れる方へ動く。「最も近い」や複数いる場合の優先順位は鬼の3の場合と同様。離れる方向は「近づく」場合の逆だが、端にいて逆方向が進めない場合、東西南北の一方だけに進もうとした場合は時計回りに動こうとする（例：北の端にいて北に進もうとした場合、東に進もうとする）。斜めの場合は`x`と`y`のどちらか一方だけでも動こうとする（例：北の端にいて北西に進もうとした場合、西に進む）。角にいて動けない（例：北東の隅にいて北に行こうとしたり北東に行こうとした）場合には諦めて今の場所に留まる。鬼がいない場合は動かない。

子の3については様々なパターンが発生するので、注意して読むこと。この行動パターンでは今の状態しか考慮していない。
<!-- 先回りや他の鬼/子との協力など、改善できる部分はいくらでもあるが、課題としては要求しない。 -->


### 出力フォーマット

出力は、以下のブロックの繰り返しと結果を表す1行で構成される。
- 何単位時間経過したかを表す1行（`n`単位時間経過したことを`step n`と表示）、`n`は0から始まりブロック毎に1ずつ増加する
- 各鬼の現在位置、鬼毎に空白を空けただけの`x y`の形式
- 各子の位置、ただし捕まった場合は"captured"`の文字列のみ表示
結果は鬼の勝ちならばO、子の勝ちならばCの一文字で構成される。

繰り返すブロック数は、鬼の勝ちの場合は全ての子が捕まった時間まで、子の勝ちの場合は`N`時間まで（`N+1`ブロック）になる。
なお、`step 0`のブロックには初期状態が表示される。
`C`が0の場合、`step 0`のブロックを表示した後結果を表示して終了する（鬼の勝ち）ことに注意せよ。


### プログラムの実行方法

上記の入出力は全てファイルに対して行う。
入力は実行時引数の第1引数として与え、出力はその後ろに`.log`というファイル名を付けたものとする。
例えば以下のコマンド

	> java Main5 sample0-1.txt

を実行すると、`sample0-1.txt`というファイルから入力フォーマットに従って入力を読み込み、`sample0-1.txt.log`というファイルに出力フォーマットに従った出力を書き込む。
なお、引数を与えなかった場合や2つ以上与えた場合の挙動は自由にして良い。（例えば引数がない場合に特定のファイルを対象にする、2つで出力先を決定する、複数与えて順に実行する、などを自身の開発のしやすさに応じて決めて良い）
また、標準入出力やエラー出力の利用についても特に限定はしない。 <!-- ただし物理精神問わず攻撃に該当する行為は禁止する -->


### 入出力例

入力例は`sample0-x.txt`から`sample4-x.txt`まで用意されている。（xは0から始まり、いくつか存在）
対応する出力例は`sample0-x_output.txt`から`sample4-x_output.txt`である。（`Main5`の出力するファイルに上書きされないように別のファイル名にしている）
比較は`diff`コマンドなどを用いると良い。（Linux/Unix系列であれば`diff`コマンドは標準で入っているはずである。Windowsならば`fc`コマンドを用いると良い。）

それぞれの入力例の使っている機能は以下の通りである。

- `sample0-x.txt`：`O`と`C`が高々1で、行動パターンは鬼と子ともに0のみである。
- `sample1-x.txt`：`O`と`C`が1で、行動パターンは鬼と子ともに1か2である。
- `sample2-x.txt`：`O`と`C`に特段の制限がない（パラメータ制限のとおり100以下）。行動パターンは鬼と子ともに0から2まで。
- `sample3-x.txt`：`O`と`C`が1で、行動パターンは0から3まで。
- `sample4-x.txt`：`O`と`C`に制限がなく、行動パターンも0から3まで。

採点についても大まかにはこの分類に従って行う。


### 拡張（オプショナル）

行動パターンの追加や領域の配置の変更など、上記の仕様にない機能をある程度自由に追加して良い。
ただし、拡張する場合は既存の入出力に変化がないようにすること。特に仮定している条件を変更する場合（領域が矩形なのを十字にするなど）で答えが変わるような拡張にならないように、入力のフォーマットが干渉しないよう気をつけること。
大きな変化の場合、実行時引数で別モードのように拡張を実装しても良いが、必ず「プログラムの実行方法」に記した方法では指示通りの実行結果が得られるようにすること。



## 課題としての制約事項

以下の制約事項に違反する場合、本課題の点数は自動で0点となるので注意すること。

+ `Main5`以外のクラスを最低でも3つ定義すること。ただしこの講義は設計の講義ではないため、クラスの設計内容に関しては評価の対象としない。
+ `Main5`以外のクラスは無名パッケージ以外のパッケージ内に存在すること。（パッケージ名は指定しないので自由に設定せよ）
+ 複数の`static`ではないフィールドやメソッドを実装すること。（`static`フィールドや`static`メソッドを利用することは問題ないが、実装の大半がそれらの参照・実行で占められている場合は0点とする）
+ 入力例に対して出力例を読み込むなど、明らかにシミュレーションをしていないような実装をしないこと。

なお、盗用・剽窃などの行為を行った場合には本課題だけでなく本講義の得点そのものを0点とする。

